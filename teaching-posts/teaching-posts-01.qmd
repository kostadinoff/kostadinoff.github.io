---
title: "Основна терминология. Стандартизация"
author: "Костадин Костадинов"
date: 2024-11-03
description: "Материалът представя основната терминология за екстензивни и интензивни показатели както и метода на директна стандартизация."
categories: 
  - "Bulgarian"
  - "Statistics"
  - "Class 1"
  - "Standardization"
  - "Terminology"
language: custom.yml
title-meta: "Основна терминология. Стандартизация"
author-meta: "Костадин Костадинов"
date-meta: 2024-11-03
---


```{r}
#| include: false
#| warning: false
library(tidyverse)


theme_nice <- ggthemes::theme_tufte() +
  theme(
    axis.ticks = element_line(linewidth = 0.5, color = "black"),
    axis.ticks.length = unit(4, "mm"),
    plot.title = element_text(
      family = "Sofia Sans Condensed",
      size = 20,
      hjust = 0,
      vjust = 2
    ),
    plot.subtitle = element_text(
      family = "Sofia Sans Condensed", 
      size = 18),
    plot.caption = element_text(
      family = "Sofia Sans Condensed",
      size = 16,
      hjust = 1
    ),
    axis.title = element_text(
      family = "Sofia Sans Condensed", 
      size = 18),
    axis.text = element_text(
      family = "Sofia Sans Condensed", 
      size = 18),
    axis.text.x = element_text(margin = margin(5, b = 10)),
    strip.text = element_text(
      family = "Sofia Sans Condensed", 
      size = 18),
    axis.line = element_line(),
    legend.text = element_text(
      family = "Sofia Sans Condensed", 
      size = 16),
  )

# Set the defined theme as the default theme
theme_set(theme_nice)
```


# Защо учим статистика?

-   Статистиката е метод чрез който данните се превръщат в информация.
-   Статистиката помага в ежедневната медицинска практика, чрез създаване на клинични наръчници или политики в здравеопазването.
-   Статистиката е езикът на науката, тя помага както на пациентите, така и за поддържане на здравето в обществото.

# С какво ще ни помогне статистиката?

-   Да взимаме **информирани решения** в ежедневната ни практика.
-   Да разберем как работи **науката**.
-   За да четем критично **нова** научна информация.

# Какво няма да научите?

Понастоящем статистиката е основата на "науката за данните" и изкуствения интелект (data science). В съчетание със сложна математика, програмиране и доза креативност, тази нова дисциплина навлиза във всекидневния ни живот докато пазаруваме, учим и работим. Всички технологии базирани на "изкуствен интелект" същност използват статистика [^1] . В този курс, обаче целта е да придобиете най-основните знания за това как работи статистиката, каква е логиката в нея и какъв език използва.

[^1]: В момента дори има разработени скенери които "сами разчитат" дали пациента има заболяване и показват какво е то. Разработени са и електрокардиографии, записващи сърдечната дейност на пациента и "автоматично" разпознаване дали е налице определено заболяване.


# Терминология

За да "не сме изгубени в превода", въвеждаме някои основни термини, обяснени с примери. 

## Абсолютни величини

::: column-page-right

::: {.callout-warning collapse="false" appearance="default" icon="true"}
### Определение

Това са **числа**, които количествено характеризират обемите на статистическите съвкупности или на части от тях. Те представляват стойност на конкретни статистически признаци.

:::

:::

- Абсолютните величини са винаги **наименовани** с конкретни **мерни единици**.

- Статистическите изследвания, обикновено започват с анализ на абсолютните величини, но те **не са достатъчни** за директни сравнения в **пространствено-времеви аспект.**

### Примери за абсолютни величини

Систолното артериално налягане измерено в *mmHg* е абсолютна величина - има числова стойност, мерна единица и количествено характеризира определен признак. Кръвната захар измерена в mmol/l също е абсолютна величина - отново е число с мерна единица и измерващо конкретен показател. 

## Относителни величини

::: column-page-right

::: {.callout-warning collapse="false" appearance="default" icon="true"}
### Определение

Те се изчисляват при разделяне на две абсолютни величини. Представят се като коефициенти, а при умножение по 100 или 1000 в проценти или промили.

:::

:::

## Примери за относителни величини

В медицината, често използваме относителни величини. Например, когато измерваме помпената функция на сърцето можем да измерим количеството кръв, което постъпва в аортата, след едно сърдечно съкращение. Това е абсолютната величина **ударен обем**. Хората с по-висок ръст и по-високо тегло (по-едро телосложение) имат по-високи стойности на усърдния обем, спрямо тези с по-нисък ръст и по-малко тегло. Така например сърцето на състезател по сумо изтласква по-голямо количество кръв (в милилитри), спрямо сърцето на първокласник. Означава ли това, че сърцето на сумиста работи по-добре от това на първокласника? Отговорът е, че не можем да преценим - двете абсолютни величини не бива да се сравняват директно. Затова по-важното, в случая е съотношението на ударният обем, спрямо количеството кръв налично в сърцето, точно преди неговото съкращение. Това е т.н "фракция на изтласкване" и представлява **относителна величина**. 

## Екстензивни показатели

::: {.callout-warning collapse="false" appearance="default" icon="true"}
### Определение

Това са **структурни** показатели, които показват как едно статистическо явление се разпределя на съставните си части в определено време и място.
:::

### Примери за екстензивни показатели

Ако приемем "възрастта" в гр. Пловдив за статистическо "явление" можем да представим всички жители на града в категории по възрастова група - новородени до 1 г., деца между 1 и 5 год., от 5 до 10 г. и т.н. Ако разделим броя на хората в съответната възрастовата група, спрямо всички жители на града ще получим екстензивен показател - измерен в процент. На @fig-age e представено разпределението на възрастта в гр. Пловдив. **Важно** за екстензивните показатели е, че сумата от всички тях е равна на 1 (или 100%).

```{r}
#| include: false
#| warning: false

library(ggthemes)
library(gt)
library(gtsummary)
library(showtext)
library(ggeffects)
library(patchwork)
library(scales)
library(sysfonts)
library(ggsci)
library(ggridges)
library(rstatix)
library(statsExpressions)
library(tidyverse)
library(broom)
library(showtext)
library(janitor)
```


```{r}
#| include: false
#| warning: false

example_1 <-
  read.csv(
    "https://raw.githubusercontent.com/kostadinoff/Medical_statistics_BG/main/practical_1/ex1.csv",
    sep = ";"
  )

example_1$numb = as.numeric(example_1$numb)

example_1$age <-
  factor(
    example_1$age,
    levels = c(
      "0",
      "1 to 4",
      "5 to 9" ,
      "10 to 14" ,
      "15 to 19",
      "20 to 24",
      "25 to 29",
      "30 to 34" ,
      "35 to 39",
      "40 to 44",
      "45 to 49",
      "50 to 54" ,
      "55 to 59",
      "60 to 64" ,
      "65 to 69" ,
      "70 to 74",
      "75 to 79",
      "80 to 84" ,
      "85 to 89" ,
      "90 to 94",
      "95 to 99",
      "100+"
    ),
    ordered = TRUE
  )
```

```{r}
#| fig-cap: "Пример за екстензивен показател.Възраст на населението в гр. Пловдив, 2022 г."
#| label: fig-age
#| echo: false
#| cap-location: margin
#| warning: false
example_1 %>%
  mutate(y = numb / sum(numb)) %>%
  ggplot(aes(x = age, y = numb)) +
  geom_col(fill = "white", colour = "black")+
  geom_text(
    aes(label = scales::percent(y, accuracy = 0.1)),
    position = position_dodge(width = .9),
    angle = 90,
    # move to center of bars
    hjust = -0.2,
    vjust = +0.2,
    # nudge above top of bar
    size = 4,
    family = "Sofia Sans Condensed"
  ) +
  guides(
    x = guide_axis(cap = "both"), # Cap both ends
    y = guide_axis(cap = "both") # Cap the upper end
  )+
  labs(title = " ", x = " ", y = "") +
  expand_limits(y = 70000)+
  theme(legend.position = "none",
        axis.line = element_line(),
        axis.text.x = element_text(angle = 90)) 

```

## Интензивни показатели

::: column-page-right
::: {.callout-warning collapse="false" appearance="default" icon="true"}
### Определение

Това са  **честотни** показатели, които показват колко често се среща дадено явление в свойствената си среда. Всеки интензивен показател е съотношение между обемите на две **различни** статистически съвкупности, намиращи се във връзка една с друга. В числителя е явлението от което се интересуваме, а в знаменателя е абсолютният обем на средата, в която възниква то.
:::
:::


### Примери за интензивни показатели

1.  **Леталитетът** представлява броя смъртни случаи от конкретно заболяване, спрямо общия брой болни от това заболяване. Ако леталитетът от морбили (дребна шарка) при деца (до 18 г.) е 5%, това означава, че от 100 деца със заболяването, 5 са починали. С други думи, показателят представя **честотата** на една статистическа съвкупност (смъртните случаи) върху друга съвкупност (болните деца). 

2.  **Смъртността** представлява съотношение на броя на починалите, спрямо средния брой население. **Смъртността по причини** представлява броя на починалите от дадено заболяването, разделен на броя на всички починали. Двата показателя не бива да се бъркат с леталитета.

3.  **Заболеваемостта**, представлява съотношението на броя новозаболели от дадено заболяване (например от рак на гърдата), спрямо популацията в риск (всички, които биха могли да се разболеят от това заболяване).

4. В ежедневната практика като лекари, също ще ползвате интензивни показатели. Например, при пациенти с белодробна астма, видът на използваното лечение, зависи от честотата на екзацербации (обостряния) т.н интензивния показател "exacerbation rate". 


# Пряк метод на стандартизация

Преди определението за стандартизация, нека представя следния пример пример. Представете си, че от днес сте министър на здравеопазването. Изправени сте пред сериозен проблем - в държавата върлува опасен вирус. Имате ваксина, но липсва доверие на гражданите в нея. Много хора смятат, че ваксините дори убиват. Днес след среща с граждани, противопоставящи се на ваксините, получавате научна статия, в която се твърди, че ваксините повишават вероятността от смърт. В @tbl-antivax можете да видите данните от нея.


```{r}
#| label: tbl-antivax
#| echo: false
#| tbl-column: margin
#| tbl-cap: "Таблица на антиваксарите"
read.csv("https://raw.githubusercontent.com/kostadinoff/Medical_statistics_BG/main/practical_1/example_vacc.csv", sep = ";") %>% 
as_tibble() %>% 
  mutate(type = recode(type,  
         'vaccinated' = 'Ваксинирани',
         'unvaccinated' = 'Неваксинирани')) %>% 
  rename(' '= type,
         Общо = total,
         Починали = deaths) |> 
  gt()
```

Авторът посочва, че след 1 година от 4000 ваксинирани са починали 2850 души, докато при 8000 неваксинирани, починали са 5500. Тези числа представляват абсолютни величини. За да се сравнят, трябва да използваме относителни. С други думи, каква пропорция от ваксинираните са починали, спрямо тази при неваксинираните. "Сметката" тук е лесна: трябва да разделим броя на починалите сред ваксинираните, върху общият брой на ваксинираните. Същата пропорция трябва да изчислим и за неваксинираните. Резултатите са относителни величини - интензивни показатели. 

```{r}
#| fig-cap: "Разлика между смъртността при ваксинирани и неваксинирани."
#| echo: false
#| column: margin
#| warning: false
  read.csv("https://raw.githubusercontent.com/kostadinoff/Medical_statistics_BG/main/practical_1/example_vacc.csv", sep = ";") %>% 
  mutate(ratio = round(deaths/total *100, 2)) %>% 
  mutate(type = recode(type,  
         'vaccinated' = 'Ваксинирани',
         'unvaccinated' = 'Неваксинирани')) %>% 
  ggplot(aes(type, ratio))+
  geom_col(fill = "white", color = "black")+
  expand_limits(y = 100)+
  coord_flip()+
  geom_text(aes(label = paste0(ratio, "%")), 
            position = position_dodge(width = .9),
            angle = 0,
            hjust = -0.1,
            vjust = 0.5,
            size = 6,
            family = "Sofia Sans Condensed")+
  guides(
    x = guide_axis(cap = "both"), # Cap both ends
    y = guide_axis(cap = "both") # Cap the upper end
  )+
  labs(title = " ", x = " ", y = "% починали")+
  theme(legend.position = "none",
        axis.line = element_line())
```

Оказва се, че в групата на ваксинираните починалите са 71.2%, докато при неваксинираните - 68.8%. Това е разлика от 2,4 процентни пункта[^2]. Може би, наистина "антиваксърите" имат право. 

[^2]: Важно: простите аритметични операции между проценти се изразяват в процентни пунктове.

Как бихме могли да си обясним този резултат? Нима наистина ваксините са причина за по-големия брой смъртни случай? Трябва ли да продължим да използваме тази ваксина? Бихте ли посъветвали пациентите си да се ваксинират?

Преди да дадем категоричното си решение, трябва да помислим върху данните. Те все още не са информация, на която да базираме решенията си. В случая, можем да разглеждаме цифрите в таблицата, като *сурови* данни измерващи една връзка. Това е връзката между ваксинация и смъртен изход. Не изглежда логично, смъртта да се причинява единствено от ваксината или липсата на такава. Има редица други фактори, които могат да повлияят - например **възрастта**. Нормално е, ако ваксинираните са по-възрастни спрямо неваксинираните, при тях да наблюдаваме повече починали, дори и ако ваксината наистина работи и ефективна. 

При сравняването на интензивни величини се наблюдава фактът, че стойността на тези показатели е в зависимост от структурата на средата, в която са изучавани явленията. За да проверим дали тази среда "замъглява" връзката между фактора и резултата, можем да използваме статистическия метод на **стандартизацията**.


::: column-page-right
::: {.callout-warning collapse="false" appearance="default" icon="true"}
## Определение

Под стандартизация се разбира преобразуването на общите коефициенти, с което се отстранява (елиминира) влиянието на възрастови или други различия в състава на сравняваните групи.
:::
:::

## Стъпки

За да извършим стандартизация (в курса по статистика се спираме единствено на **прекия метод за стандартизация**) следва да разполага с повече данни. Таблицата, която разгледахме, не съдържа информация за възрастта на участниците. Затова, след запитване към автора, получаваме по-подробни данни - представени в @tbl-age.

```{r}
#| label: tbl-age
#| tbl-cap: "Таблица с разпределние по възраст"
#| echo: false
#| cap-location: margin

read.csv(
  "https://raw.githubusercontent.com/kostadinoff/Medical_statistics_BG/main/practical_1/full_data.csv",
  sep = ";",
  stringsAsFactors = T
) %>%
  as_tibble() %>%
  mutate(group = recode(group,  
         'vaccinated' = 'Ваксинирани',
         'unvaccinated' = 'Неваксинирани')) %>% 
  mutate(age_group = recode(age_group,  
         "under 24"  = 'под 24 г.',
         "25 to 34"  = '25-34г.',
         "35 to 44 "= '35-44г.',
         "over 45" = "над 45г."
         )) %>% 
  rename(Възраст = age_group,
         Общо = total_number,
         Починали = deaths) %>% 
  gt(groupname_col = "group") %>% 
  tab_options(row_group.as_column = TRUE) 
```

Може би, ви прави впечатление от @fig-by-age, че ваксинираните, са предимно по-възрастни хора, докато при неваксинираните преобладават по-младите.

```{r}
#| label: fig-by-age
#| fig-cap: "Разлика на възрастовата структура между ваксинирани и неваксинирани - възрастовите групи са представени от млади към стари.в групата до 24 г. преобладат неваксинирани, докато при над 45-годинишните ваксинираните"
#| echo: false
#| cap-location: margin
#| warning: false

read.csv(
  "https://raw.githubusercontent.com/kostadinoff/Medical_statistics_BG/main/practical_1/full_data.csv",
  sep = ";",
  stringsAsFactors = T
) %>%
  as_tibble() %>%
  mutate(group = recode(group,
                        'vaccinated' = 'Ваксинирани',
                        'unvaccinated' = 'Неваксинирани')) %>%
  mutate(age_group = factor(age_group, levels = c("under 24", "25 to 34", "35 to 44 ", "over 45"))) %>%
  mutate(
    age_group = recode(
      age_group,
      "under 24"  = 'под 24 г.',
      "25 to 34"  = '25-34г.',
      "35 to 44 " = '35-44г.',
      "over 45" = "над 45г."
    )
  )  |> 
  rename(Възраст = age_group,
         Общо = total_number,
         Починали = deaths) %>%
  ggplot(aes(Общо, Възраст, fill = group)) +
  geom_col(color = "black", position = "fill") +
  theme(legend.position="bottom",
        legend.title=element_blank(),
        axis.title.x=element_blank())+
  guides(
    x = guide_axis(cap = "both"), # Cap both ends
    y = guide_axis(cap = "both") # Cap the upper end
  )+
  scale_x_continuous(labels = scales::percent_format(accuracy = 1))+
  labs(title = " ", y = " ")+
  scale_fill_manual(values = c("white", "grey"))
```

#### Стъпка 1 Изчисляване на **нестандартизираните** интензивни показатели

Както по-рано, така и сега, можем да изчислим, какъв процент от участниците в двете групи са починали. В случая ще направим това за всяка една възрастова група. Резултатите са представени в колона *леталитет* в @tbl-case_fatality  .


```{r}
#| label: tbl-case_fatality
#| tbl-cap: "Нестандартизиран леталитет. Тук е важно да запомним, че общият нестандартизиран показател не е сума от резултатите по групи. Не можем да сумираме нестандартизираните показатели."
#| echo: false
#| cap-location: margin

read.csv(
  "https://raw.githubusercontent.com/kostadinoff/Medical_statistics_BG/main/practical_1/full_data.csv",
  sep = ";",
  stringsAsFactors = T
) %>%
  as_tibble() %>%
  group_by(group, age_group) %>%
  mutate (fatality_rate_unstandardized = deaths / total_number) %>%
  mutate(age_group = factor(age_group, levels = c("under 24", "25 to 34", "35 to 44 ", "over 45"))) %>%
  mutate(group = recode(group,
                        'vaccinated' = 'Ваксинирани',
                        'unvaccinated' = 'Неваксинирани')) %>%
  mutate(
    age_group = recode(age_group,
                       "under 24"  = 'под 24 г.',
                       "25 to 34"  = '25-34г.',
                       "35 to 44 " = '35-44г.',
                      "over 45" = "над 45г.")) %>%
  rename(
    Възраст = age_group,
    Общо = total_number,
    Починали = deaths,
    "Леталитет" = fatality_rate_unstandardized
  ) %>%
  gt(groupname_col = "group") %>%
  tab_options(row_group.as_column = TRUE) %>%
  tab_footnote(footnote = "Нестандартизиран",
               locations = cells_column_labels(columns = "Леталитет"))
```

#### Стъпка 2 Изчисляване на "стандарт"

За да направим стандартизацията е необходимо да изберем за стандарт, една от двете възрастови структури - тази на ваксинираните или тези на неваксинираните.

Тук, често възниква въпросът коя структура трябва да изберем? Защо да предпочетем едната спрямо другата? Какво е правилото?

Всъщност, няма особено значение точно коя структура се избира. Разбира се, числата след стандартизация зависят от избора и те биха се различавали. От значение, обаче е разликата, а не конкретните стойности на стандартизиран леталитет в двете групи  [^3]

[^3]: В това упражнение ще докажем това, като извършим стандартизацията, като вземем за стандарт, първо възрастовата структура на неваксинираните, а после тази на ваксинираните.


Какво обаче е стандартът?

Ако изберем за стандарт групата на неваксинираните, за да изчислим стандарта - ще използваме броя на участниците във всяка възрастова група за числител, а общия брой неваксинирани за знаменател. Полученият коефициент е “стандарт” за конкретната възрастова група.

В @tbl-standart са представени получените стандарти. 

Неваксинираните участниците под 24 год. са 4000, а общият брой неваксинирани 8000. Стандартът за тази група е 0.5 (ако умножим по 100 ще получим 50%). Това е стандартът за тази група, които обаче ще използваме и за ваксинираните.

Може да ви направи впечатление, че сборът на всички стандарти е равен на 1-ца (тоест 100%). Това е така, защото стандартът винаги е екстензивен показател.


```{r}
#| label: tbl-standart
#| tbl-cap: "Определяне на стандарт за всяка възрастова група"
#| echo: false
#| cap-location: margin

read.csv(
   "https://raw.githubusercontent.com/kostadinoff/Medical_statistics_BG/main/practical_1/full_data.csv",
  sep = ";",
  stringsAsFactors = T
) %>%
  as_tibble() %>%
  mutate(age_group = factor(age_group, levels = c("under 24", "25 to 34", "35 to 44 ", "over 45"))) %>%
  filter(group =="unvaccinated") %>% 
  group_by(age_group) %>% 
  summarise(total_number, deaths) %>% 
  mutate(standard_unvaccinated = total_number/sum(total_number)) %>% 
  mutate(
    age_group = recode(age_group,
                       "under 24"  = 'под 24 г.',
                       "25 to 34"  = '25-34г.',
                       "35 to 44 " = '35-44г.',
                      "over 45" = "над 45г.")) %>%
  rename(
    Възраст = age_group,
    Общо = total_number,
    Починали = deaths,
    Стандарт = standard_unvaccinated
  ) %>%
  gt() %>% 
  tab_footnote(footnote = "За изчисляване на колоната стандарт е изпозлвана възрастовата структура на неваксинираните",
               locations = cells_column_labels(columns = "Стандарт"))


```

#### Стъпка 3: Изчисляване на стандартизираните показатели

За да изчислим стандартизираният леталитет, за всяка възрастова група **умножаваме** нестандартизирания показател по посоченият по-горе стандарт. 

```{r}
#| label: tbl-final
#| tbl-cap: "Например, за възрасттовата група до 24 г. при ваксинираните, нестандартизирания леталитет е 0,5, а стандартът 0,250. За да стандартизираме умножаваме 0,5 по 0.250. При неваксинираните, отново за същата възрастова група умножаваме нестандартизирания показател 0,6 по стандарта 0,25"
#| echo: false

read.csv(
  "https://raw.githubusercontent.com/kostadinoff/Medical_statistics_BG/main/practical_1/full_data.csv",
  sep = ";",
  stringsAsFactors = T
) %>%
  as_tibble() %>%
  mutate (fatality_rate_unstandardized = deaths / total_number) %>%
  mutate(
    standard_unvaccinated = c(0.5, 0.25, 0.125, 0.125, 0.5, 0.25, 0.125, 0.125)
    ) %>% 
  mutate(
    fatality_rate_standardized = fatality_rate_unstandardized *  standard_unvaccinated
    ) %>% 
  mutate(group = recode(group,
                        'vaccinated' = 'Ваксинирани',
                        'unvaccinated' = 'Неваксинирани')) %>%
  mutate(
    age_group = recode(age_group,
                       "under 24"  = 'под 24 г.',
                       "25 to 34"  = '25-34г.',
                       "35 to 44 " = '35-44г.',
                      "over 45" = "над 45г.")) %>%
  rename(
    Възраст = age_group,
    Общо = total_number,
    Починали = deaths,
    Стандарт = standard_unvaccinated,
    "НС Леталитет"= fatality_rate_unstandardized,
    Стандарт = standard_unvaccinated,
    "С Леталитет"= fatality_rate_standardized
  ) %>%
  gt(groupname_col = "group") %>%
  tab_options(row_group.as_column = TRUE) %>%
  tab_footnote(footnote = "Нестандартизиран леталитет",
               locations = cells_column_labels(
                 columns = "НС Леталитет")) %>% 
  tab_footnote(footnote = "Изчислен спрямо неваксинираните",
               locations = cells_column_labels(
                 columns = "Стандарт")) %>% 
  tab_footnote(footnote = "Стандартизиран леталитет",
               locations = cells_column_labels(
                 columns = "С Леталитет"))
```

На този етап стандартизацията е почти изпълнена - Вече знаем, че **нестандартизираните показатели не се събират**. За сметка на това **стандартизираните се събират**. Когато ги съберем получаваме общия стандартизиран леталитет, който е "изчистен" от замъгляващия ефект на различната възраст в двете групи. С други думи, показателите след стандартизация, представят какъв би бил леталитетът, ако двете групи имаха еднаква възрастова структура. 

#### Стъпка 4: Заключение

Нека извършим тази последна калкулация.

За групата на ваксинираните общият стандартизиран леталитет е:

-   **25 %** (стандартизираният леталитет за всички до 24 г.) + **15 %** (стандартизираният леталитет за възрастовата група от 25-34 г.) + **8,7 %** (стандартизираният леталитет за възрастовата група от 35-44 г.) + **10 %** (стандартизираният леталитет за възрастовата група над 45 г.). Общо за всички ваксинирани, стандартизираният леталитет е 58.7%

За групата на неваксинираните общият стандартизиран леталитет е:

-   **30 %** (стандартизираният леталитет за всички до 24 г.) + **17,5 %** (стандартизираният леталитет за възрастовата група от 25-34 г.) + **10 %** (стандартизираният леталитет за възрастовата група от 35-44 г.) + **11,25 %** (стандартизираният леталитет за възрастовата група над 45 г.). Общо за всички ваксинирани, стандартизираният леталитет е 65.75%


::: column-page-right
::: {.callout-caution collapse="false" appearance="default" icon="true"}

### Заключение

Стандартизираните показатели за леталитет в двете групи са съответно **58.75 %** и **68.75 %**. Леталитетът сред неваксинираните, е с **10 %** по-висок.
:::
:::

Стандартизираните показатели позволяват да се анализира и оцени нивото на изучаваното явление при създадени условия на **еднородност**, тоест методът ни показва какви биха били коефициентите, в сравняваните групи, ако те имаха еднакъв състав.

## Стъпки - при алтернативен избор за стандарт

За да докажем, че изводът не зависи от избора на стандарт, ще решим отново примера, като този път използваме за стандарт възрастовата структура на ваксинираните. 

#### Стъпка 2 Изчисляваме стандарта (този път спрямо ваксинираните)

Сега ще използваме данните само за ваксинираните. При тях, частниците под 24 г. са 500 от общо 4000. Това означава, че стандартът за тази група е 0.125 (или 12.5%). Получените стандарти са представени в @tbl-standart_alt .

```{r}
#| label: tbl-standart_alt
#| tbl-cap: "Определяне на стандарт за всяка възрастова група"
#| echo: false
#| cap-location: margin
read.csv(
  "https://raw.githubusercontent.com/kostadinoff/Medical_statistics_BG/main/practical_1/full_data.csv",
  sep = ";",
  stringsAsFactors = T
) %>%
  as_tibble() %>%
  mutate(age_group = factor(age_group, levels = c("under 24", "25 to 34", "35 to 44 ", "over 45"))) %>%
  filter(group =="vaccinated") %>% 
  group_by(age_group) %>% 
  summarise(total_number, deaths) %>% 
  mutate(standard_unvaccinated = total_number/sum(total_number)) %>% 
  mutate(
    age_group = recode(age_group,
                       "under 24"  = 'под 24 г.',
                       "25 to 34"  = '25-34г.',
                       "35 to 44 " = '35-44г.',
                      "over 45" = "над 45г.")) %>%
  rename(
    Възраст = age_group,
    Общо = total_number,
    Починали = deaths,
    Стандарт = standard_unvaccinated
  ) %>%
  gt() %>% 
  tab_footnote(footnote = "За изчисляване на колоната стандарт е изпозлвана възрастовата структура на ваксинираните",
               locations = cells_column_labels(columns = "Стандарт"))

```

#### Стъпка 3: Изчисляване на стандартизираните показатели за леталитет

След като имаме "стандарт", този път в основа на групата на ваксинираните, можем да пристъпим отново към стъпка 3 - стандартизация тя е представена в @tbl-final_alt

```{r}
#| label: tbl-final_alt
#| tbl-cap: "Отново, за възрасттовата група до 24 г.при ваксинираните, нестандартизирания леталитет е 0,5, а новият стандарт 0,125. Стандартизираният леталитет е 0,5x0,125 =  0,0625. При неваксинираните, до 24 г. нестандартизирания леталитет е 0,6, за да получим стандартизирания умножаваме по стандарта 0,125, получаваме 0,075)"
#| echo: false

read.csv(
  "https://raw.githubusercontent.com/kostadinoff/Medical_statistics_BG/main/practical_1/full_data.csv",
  sep = ";",
  stringsAsFactors = T
) %>%
  as_tibble() %>%
  mutate(age_group = factor(age_group, levels = c("under 24", "25 to 34", "35 to 44 ", "over 45"))) %>%
  mutate (fatality_rate_unstandardized = deaths / total_number) %>%
  mutate(
    standard_vaccinated = c(0.125, 0.125, 0.25, 0.5, 0.125, 0.125, 0.25, 0.5)
    ) %>% 
  mutate(
    fatality_rate_standardized = fatality_rate_unstandardized *  standard_vaccinated
    ) %>% 
  mutate(group = recode(group,
                        'vaccinated' = 'Ваксинирани',
                        'unvaccinated' = 'Неваксинирани')) %>%
  mutate(
    age_group = recode(age_group,
                       "under 24"  = 'под 24 г.',
                       "25 to 34"  = '25-34г.',
                       "35 to 44 " = '35-44г.',
                      "over 45" = "над 45г.")) %>%
  rename(
    Възраст = age_group,
    Общо = total_number,
    Починали = deaths,
    Стандарт = standard_vaccinated,
    "НС Леталитет"= fatality_rate_unstandardized,
    "С Леталитет"= fatality_rate_standardized
  ) %>%
  gt(groupname_col = "group") %>%
  tab_options(row_group.as_column = TRUE) %>%
  tab_footnote(footnote = "Нестандартизиран леталитет",
               locations = cells_column_labels(
                 columns = "НС Леталитет")) %>% 
  tab_footnote(footnote = "Изчислен спрямо неваксинираните",
               locations = cells_column_labels(
                 columns = "Стандарт")) %>% 
  tab_footnote(footnote = "Стандартизиран леталитет",
               locations = cells_column_labels(
                 columns = "С Леталитет"))
```

Логично, след като сме използвали друг стандарт, числовите стойности са различни, но заключението едно и също.

::: column-page-right
::: {.callout-caution collapse="false" appearance="default" icon="true"}
### Заключение

Стандартизираните показатели за леталитет в двете групи са съответно **71.25 %** и **81.25 %**. Леталитетът сред неваксинираните, е с **10 %** по-висок.
:::
:::

# Задачи за самоподготовка

1.  Да се определи възрастовата структура на преминалите болни през Болница Х, като разполагате със следните данни:


| Възраст                  | 0-1 г. | 1-4 г. | 5-9 г. | 10-19 г. | Общо |
|--------------------------|:------:|:------:|:------:|:--------:|:----:|
| Болни с Хепатит А        |   70   |   41   |  102   |    87    | 300  |
| Възрастова структура (%) |        |        |        |          |      |


2.  Да се изчислят стандартизираните показатели за плодовитостта в районите А и Б. За стандарт да се приеме възрастовият състав на жените от район Б. Да се анализират получените резултати.

|         | Район А |            | Район Б |            |
|---------|---------|------------|---------|------------|
| Възраст | Жени    | Живородени | Жени    | Живородени |
| 15-19   | 1 000   | 18         | 1 200   | 22         |
| 21-30   | 9 000   | 225        | 7 000   | 175        |
| 31-49   | 8 000   | 128        | 10 000  | 160        |
| Всичко  | 18 000  | 371        | 18200   | 357        |


3.  Да се изчислят стандартизираните показатели за леталитета в две градски болници - Болница А и Болница Б. За стандарт да се приеме съставът на болните в болница Б. Да се анализират получените резултати.

+---------------------+------------+------------+------------+------------+
| Болест              | Преминали  | Починали   | Преминали  | Починали   |
|                     |            |            |            |            |
|                     | (А)        | (А)        | (Б)        | (А)        |
+=====================+============+============+============+============+
| Хипертонична болест | 180        | 4          | 200        | 4          |
+---------------------+------------+------------+------------+------------+
| Рак на стомаха      | 100        | 30         | 90         | 27         |
+---------------------+------------+------------+------------+------------+
| Инфаркт на миокарда | 120        | 8          | 160        | 10         |
+---------------------+------------+------------+------------+------------+
| Всичко              | 400        | 42         | 450        | 41         |
+---------------------+------------+------------+------------+------------+

4. Нестандартизираните показатели за леталитет в две болници А и Б са съответно 10‰ и 12‰. След стандартизация, спрямо болница А, леталитетът в болница А е 10‰, а този в болница Б 8‰. Изчислете стандартизираните леталитети, ако за стандарт се ползва болница Б. 

